$(document).ready(function(){function t(t,e){$.getJSON("Data/products.json",function(r){totalPrice=parseFloat($("#totalPrice").html()),$.each(r,function(r,n){n.id==t&&(price=(n.price*e).toFixed(2),totalPrice+=parseFloat(price),content="<tr>",content+='<td class="productID">'+n.id+"</td>",content+="<td>"+n.description+"</td>",content+="<td>"+n.category+"</td>",content+="<td>"+n.price+"€</td>",content+='<td class="qtt">'+e+"</td>",content+='<td class="price">'+price+"€</td>",content+='<td><button type="button" class="btn btn-danger btn-xs removebutton">DELETE</button></td>',content+="<tr/>",$(content).appendTo("#posts"),n.quantity=e,o.push(n))}),$("#totalPrice").html(totalPrice.toFixed(2))})}function e(t,e,o,r){var n=new Object;n.id=t,n["customer-id"]=e,n.items=o,n.total=r;var a=JSON.parse(JSON.stringify(n));$.ajax({type:"POST",url:"discounts.php",data:a,dataType:"JSON",success:function(t){msgs=new Array,$.each(t,function(t,e){msgs.push(e.msg)}),content=$("#discountMsgs").html(),$.each(msgs,function(t,e){null!=e&&(content+=e+"<br>")}),$("#discountMsgs").html(content),r=parseFloat(t.total),$("#totalPrice").html(r.toFixed(2)),$("#total").fadeIn()},error:function(t){console.log(t)}})}var o=new Array;$.getJSON("Data/products.json",function(t){content="",$.each(t,function(t,e){content+="<option value="+e.id+">"+e.description+"</option>"}),$(content).appendTo("#products")}),$(document).on("click","button.removebutton",function(){return productID=$(this).closest("tr").find(".productID").text(),quantity=$(this).closest("tr").find(".qtt").text(),price=parseFloat($(this).closest("tr").find(".price").text()),$.each(o,function(t,e){e.id==productID&&(index=t)}),o.splice(index,1),totalPrice=parseFloat($("#totalPrice").html()),newTotal=(totalPrice-price).toFixed(2),$("#totalPrice").html(newTotal),$(this).closest("tr").remove(),!1}),$("#submitOrder").click(function(t){if(t.preventDefault(),""==$("#json_file").val())return $("#submitMsg").html("Upload a JSON order!").addClass("text-danger").fadeIn(),!1;id=$("#orderID").html(),customer=$("#customer").html(),total=$("#totalPrice").html(),o.length>0?($("#submitMsg").hide(),e(id,customer,o,total),$("#submitOrder").hide(),$(".removebutton").hide(),$("#back").fadeIn()):$("#submitMsg").html("Upload a JSON order!").addClass("text-danger").fadeIn()}),$("#back").click(function(){location.reload()}),$("#addorder-btn").click(function(e){e.preventDefault(),productID=$("#products").val(),quantity=$("#qtt").val(),0!=productID&&quantity>0?t(productID,quantity):alert("Check your inputs.")}),$("#json_file").on("change",function(e){$(".table td").remove(),$("#errorMsg").hide(),o=[],$("#totalPrice").html(0);for(var r=0;r<e.target.files.length;++r)!function(e){var o=new FileReader;o.onload=function(o){if(2==o.target.readyState)if(o.target.error)alert("Error while reading file "+e.name+": "+o.target.error);else{var r=o.target.result;if(/^[\],:{}\s]*$/.test(r.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){try{r=$.parseJSON(r),id=r.id,order=r.items}catch(t){console.log(t.message),$("#submitMsg").html("Error loading order!").addClass("text-danger").fadeIn()}$("#orderID").html(r.id),$("#customer").html(r["customer-id"]),$("#submitMsg").html("Order loaded!").addClass("text-success").fadeIn(),$.each(r.items,function(e,o){t(o["product-id"],o.quantity)})}else $("#errorMsg").show()}},o.readAsText(e)}(e.target.files[r])})});